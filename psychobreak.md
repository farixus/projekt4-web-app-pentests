# Psycho Break
## Web application pentest
### Subject
Web application pentest of machine [Psycho Break](https://tryhackme.com/room/psychobreak)
### Date
12-05-2023
### Location
Anywhere
### Auditors
farix
### Version
1.0


## Table of content
1. Executive Summary
   - Synopsis
   - Scope
   - Key Findings
   - Recommendations
2. List of Findings
3. Finding
   - Task1
   - Task2
   - Task3
   - Task4
   - Task5
4. Walkthrough


## Executive Summary

## List of Findings
### Task1
#### Title \#1
FTP
#### Description (reproduction steps)
In my scan I found opened port 21 (ftp). All transmited data through this port are send in plain text. When attacker obtain access to transmited data i.e. in method MIDM (Man-In-The-Middle) can easy uncover sensitive data.
#### Recommendations
Turn off ftp service at all and use other method. SFTP (SSH FTP), SCP (Secure Copy), etc.
#### Title \#2
Banner Grabbing
#### Description (reproduction steps)
Port Scanning shows that attacker can easy uncover types and versions of applications installed on the system and system itself, gather this information and then use if to prepare relevant manner of attack.
#### Recommendations
If not really necessery turn off displaying names and versions of installed application or change it a bit.
### Task2
#### Title

#### Description (reproduction steps)

#### Recommendations

### Task3
#### Title

#### Description (reproduction steps)

#### Recommendations

### Task4
#### Title

#### Description (reproduction steps)

#### Recommendations

### Task5
#### Title

#### Description (reproduction steps)

#### Recommendations


## Walkthrough
### Web
As we can read at the beginning this room was based on a video game called evil within. So try this out!
Deploy the machine and start Reconnaissance.

`Write ip address of machine to /etc/hosts to use friendly name instead of ip address`

Add line to /etc/hosts
```
10.10.227.164   psychobreak.sda
```

Start to scan:

```
sudo nmap -sSCV -T4 -A -oA nmap_scan psychobreak.sda

```
As a result of above commend we get opened ports with banner info and operating system name.
```
21/tcp open  ftp     ProFTPD 1.3.5a
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0)
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))

```

Answer the questions:

Deploy the machine.
`No answer needed`

How many ports are open?
`3`

What is the operating system that runs on the target machine?
`Ubuntu`
### Help Mee
Open site `psychobreak.sda` in browser

![Start Page](https://github.com/farixus/projekt4-web-app-pentests/blob/main/screenshots_psychobreak/01_start_page.png)

Nothing special, try to look, what in source page is.
```
...
<div class="center-wrapper">
		<img src="hospital.png">
	</div>

	<red><!-- Sebastian sees a path through the darkness which leads to a room => /sadistRoom -->

	<br>
...
```

I found a hint in source, namely hidden directory /sadistRoom

![sadistRoom](https://github.com/farixus/projekt4-web-app-pentests/blob/main/screenshots_psychobreak/02_sadistroom_page.png)

and a key to locker Room. 
`Key to locker Room => 532219a04ab7a02b56faafbec1a4c1ea`

Enter the key on the next page, be hurry before \"Sebastian is dead\". Click \"Go to Locker Room\"

![Enter the key here](https://github.com/farixus/projekt4-web-app-pentests/blob/main/screenshots_psychobreak/04_key_enter_page.png)

Now, we have another page \"Locker Room\". We neet to decode text: \"Tizmg_nv_zxxvhh_gl_gsv_nzk_kovzhv\" before we could go further.

Trying base64, Caesar Cipher, nothing. As a result of searching it follows that it is a `atbash code`: https://www.geeksforgeeks.org/implementing-atbash-cipher/

I modified python script (from page: https://www.geeksforgeeks.org/implementing-atbash-cipher/) to decode the string. I got key to map: Grant_me_access_to_the_map_please
After entering code on next page, got the **map**.

![Here is the map](https://github.com/farixus/projekt4-web-app-pentests/blob/main/screenshots_psychobreak/06.map_page.png)

Let's visit next room: Safe Heaven
![Safe Heaven](https://github.com/farixus/projekt4-web-app-pentests/blob/main/screenshots_psychobreak/07_safe_heaven_page.png)

In source page I found another comment: \"<!-- I think I'm having a terrible nightmare. Search through me and find it ... -->\"

Probably, there are other hidden dirs. Let's find them with gobuster
```
gobuster dir -u http://psychobreak.sda/SafeHeaven/ -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt
```
gobuster found two other dirs:
```
===============================================================
2023/05/12 11:18:01 Starting gobuster in directory enumeration mode
===============================================================
/imgs                 (Status: 301) [Size: 328] [--> http://psychobreak.sda/SafeHeaven/imgs/]
/keeper               (Status: 301) [Size: 330] [--> http://psychobreak.sda/SafeHeaven/keeper/]
Progress: 220478 / 220561 (99.96%)
===============================================================
2023/05/12 11:37:42 Finished

```
Open page: psychobreak.sda/SafeHeaven/keeper/

![The Keeper](https://github.com/farixus/projekt4-web-app-pentests/blob/main/screenshots_psychobreak/08_keeper_page.png)

Press `Escape Keeper` and I have 1min45sec to find what this place is. Let's use google to reverse search the name of image. 

![Reverse search](https://github.com/farixus/projekt4-web-app-pentests/blob/main/screenshots_psychobreak/09_safe_yourself_page.png)

Result: `St. Augustine lighthouse`

After correct answer, we got another key: The Keeper Key
`Here is your key : 48ee41458eb0b43bf82b986cecf3af01`

**Notice** the address bar
![file name](https://github.com/farixus/projekt4-web-app-pentests/blob/main/screenshots_psychobreak/10_keeper_address_bar.png)

Back to the map and open the last room: Abandoned Room
At the beginning, we need to enter early found Keeper Key. Abandoned Room page appeared. In source code nothing, so press button \"Go Further\".
![Go Further](https://github.com/farixus/projekt4-web-app-pentests/blob/main/screenshots_psychobreak/11_abandoned_room_page.png)

There is a shell? Comment in source page say so:
\"<!-- There is something called "shell" on current page maybe that'll help you to get out of here !!!-->\"

Try to run different commands. Only `ls` and `ls ..` works:
![ls](https://github.com/farixus/projekt4-web-app-pentests/blob/main/screenshots_psychobreak/13_ls_command.png)
![ls ..](https://github.com/farixus/projekt4-web-app-pentests/blob/main/screenshots_psychobreak/14_ls_up_command.png)

After some combinations with dirs I was able to uncover unprotected dir that shows files inside.

`http://psychobreak.sda/abandonedRoom/680e89809965ec41e64dc7e447f175ab/`

![Index of dir](https://github.com/farixus/projekt4-web-app-pentests/blob/main/screenshots_psychobreak/15_index_of_hidden_dir.png)

Gratulations! you made it:)
Download and unzip helpme.zip file.
```
unzip helpme.zip
```
We have two files:
- helpme.txt
- Table.jpg

Form file helpme.txt we know, there is two usernames:
- joseph
- ruvik
```
"From Joseph,

Who ever sees this message "HELP Me". Ruvik locked me up in this cell. Get the key on the table and unlock this cell
. I'll tell you what happened when I am out of this cell.
"
```
Table.jpg isn't picture file. We can proof that with command: `file`
```
file Table.jpg (not image)
Table.jpg: Zip archive data, at least v2.0 to extract, compression method=deflate
```
Let's change the extension and unzip it again:
```
mv Table.jpg Table.zip
unzip Table.zip
Archive:  Table.zip
  inflating: Joseph_Oda.jpg
  inflating: key.wav
```
We have two another files.
Ensure these are proper files:
```
file Joseph_Oda.jpg 
Joseph_Oda.jpg: JPEG image data, JFIF standard 1.01, aspect ratio, density 1x1, segment length 16, baseline, precision 8, 350x490, components 3

```
```
file key.wav       
key.wav: RIFF (little-endian) data, WAVE audio, Microsoft PCM, 8 bit, mono 8000 Hz
```

In jpg file could be hide other file using steganography. To unhide this file usually we need a passphrase (key). Second file is named as \'key\'. So let's start with this.

This is morse alphabet. Let's decode from this website: https://morsecode.world/international/decoder/audio-decoder-adaptive.html
After upload and play I got key: **SHOWME**.

![Morse Decoder](https://github.com/farixus/projekt4-web-app-pentests/blob/main/screenshots_psychobreak/16_morse_decoder.png)

Let's take the image. Use steghide to unhide the secret and use key: SHOWME
```
steghide --extract -sf Joseph_Oda.jpg
Enter passphrase:
wrote extracted data to "thankyou.txt".
```
```
cat thankyou.txt

From joseph,

Thank you so much for freeing me out of this cell. Ruvik is nor good, he told me that his going to kill sebastian an
d next would be me. You got to help
Sebastian ... I think you might find Sebastian at the Victoriano Estate. This note I managed to grab from Ruvik migh
t help you get inn to the Victoriano Estate.
But for some reason there is my name listed on the note which I don't have a clue.

           --------------------------------------------
        //                                              \\
        ||      (NOTE) FTP Details                      ||
        ||      ==================                      ||
        ||                                              ||
        ||      USER : joseph                           ||
        ||      PASSWORD : intotheterror445             ||
        ||                                              ||
        \\                                              //
           --------------------------------------------
```

After all this path finally we have credentials to ftp serever:

user: joseph
password: intotheterror445

Answer the questions:
Who is locked up in the cell?
`joseph`

There is something weird with the .wav file. What does it say?
`SHOWME`

What is the FTP Username
`joseph`

What is the FTP User Password
`intotheterror445`

### Crack it open
